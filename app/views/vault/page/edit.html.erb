<% include_javascript "/tog_vault/javascripts/fckeditor/fckeditor" %>
<% include_javascript "/tog_vault/javascripts/admin" %>
<% include_javascript "/tog_vault/javascripts/string" %>

<script type="text/javascript">
  window.onload = function() {
    var oFCKeditor = new FCKeditor( 'page[content]' ) ;
    oFCKeditor.BasePath = '/tog_vault/javascripts/fckeditor/' ;
    oFCKeditor.ReplaceTextarea() ;
  }
</script>


<% form_for :page, :url => "" , :html => {:id =>"entry"} do |f| %>
    <% if @page.new_record? -%>
    <h2 id="new_page">
      <%= I18n.t("tog_vault.page.new_page") %> 
      <%= link_to_function 'More', visual_effect(:toggle_slide , 'config'), :class => 'button configure', :title => "More Options" %>   
    </h2>
    <% else -%>
    <h2 id="edit_page">
      <%= I18n.t("tog_vault.page.edit_page") %> 
      <%= link_to_function 'More', visual_effect(:toggle_slide , 'config'), :class => 'button configure', :title => "More Options" %>   
      
    </h2>
    <% end -%>
    <div id="config" style="display:none">
        <fieldset>
          <legend>More options</legend>
          <div class="group">
            <label>
              <%= I18n.t("tog_vault.page.slug") %> <small>Auto-generated</small>
              <%= text_field "page", "slug", {:size => nil} %>
            </label>
            <label>
              <%= I18n.t("tog_vault.page.breadcrumb") %> 
              <%= text_field "page", "breadcrumb", {:size => nil} %> 
            </label>
          </div>               
          <label><%= I18n.t("tog_vault.page.tags") %> 
            <%= text_field "page", "tag_list", {:size => nil} %>
          </label>
        </fieldset>
    </div> 	    
    


    <fieldset>

      <fieldset>
        <fieldset>
          <legend>Metadata</legend>
          <label>
            <%= I18n.t("tog_vault.page.status") %>
            <%= select_tag "state", %{#{options_for_select(Page.states.inject({}) {|s, e| s[e]=e; s}, @page.new_record? ? :draft : @page.current_state)}} %> 
          </label>
        </fieldset>
      </fieldset>   

      <label for="page_title">
        <%= I18n.t("tog_vault.page.page_title") %>
        <%= text_field "page", "title", {:size => nil} %>
      </label>
     
      <label>
        Body
        <%= render :partial => 'part', :locals => { :content => @page } %>
      </label>


      <%= updated_stamp @page %>

      <%= save_model_button(@page) %> <%= save_model_and_continue_editing_button(@page) %>

    </fieldset>
<% end %>

<script type="text/javascript">
// <![CDATA[
  $title = $('page_title');
  $slug = $('page_slug');
  $breadcrumb = $('page_breadcrumb');
  $old_title = $title.value || '';
  function title_updated() {
    if ($old_title.toSlug() == $slug.value) $slug.value = $title.value.toSlug();
    if ($old_title == $breadcrumb.value) $breadcrumb.value = $title.value;
    $old_title = $title.value;
  }
  new Form.Element.Observer('page_title', 0.15, title_updated);
// ]]>
</script>
